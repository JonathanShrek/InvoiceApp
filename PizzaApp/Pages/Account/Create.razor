@page "/account/create"
@inject HttpClient Http
@using System.ComponentModel.DataAnnotations

<MudContainer MaxWidth="MaxWidth.Medium">
    <MudPaper Elevation="3" Class="pa-1 my-3 rounded-md">
        
        <MudGrid>
            @if (IsLoading)
            {
                <MudItem xs="12" Class="pa-10 d-flex align-self-center justify-center">
                    <MudProgressCircular Color="Color.Success" Indeterminate="true" />
                </MudItem>
            }
            else
            {
                <MudItem xs="12">
                    <EditForm OnValidSubmit="CreateAccount" Model="NewUser">
                        <DataAnnotationsValidator />
                        <MudGrid>
                            <MudItem xs="12" sm="12" md="6" Class="d-flex align-self-center justify-md-start justify-center">
                                <h1>Create an Account</h1>
                            </MudItem>
                        </MudGrid>

                        <MudGrid>
                            <MudItem xs="12" sm="12" md="6">
                                <MudTextField Label="First Name" @bind-Value="NewUser.FirstName" For="@(() => NewUser.FirstName)" />
                            </MudItem>
                            <MudItem xs="12" sm="12" md="6">
                                <MudTextField Label="Last Name" @bind-Value="NewUser.LastName" For="@(() => NewUser.LastName)" />
                            </MudItem>
                        </MudGrid>

                        <MudGrid>
                            <MudItem xs="12">
                                <MudTextField Label="Username" @bind-Value="NewUser.Username" For="@(() => NewUser.Username)" InputMode="InputMode.text" InputType="InputType.Text" Immediate="true" />
                            </MudItem>
                        </MudGrid>

                        <MudGrid>
                            <MudItem xs="12" sm="12" md="6">
                                <MudTextField @bind-Value="NewUser.Password"
                                          For="@(() => NewUser.Password)"
                                          Label="Password"
                                          Variant="Variant.Text"
                                          InputType="@PasswordInput"
                                          Adornment="Adornment.End"
                                          AdornmentIcon="@PasswordInputIcon"
                                          OnAdornmentClick="TogglePasswordVisibility"
                                          AdornmentAriaLabel="Show Password"
                                          Immediate="true" />
                            </MudItem>
                            <MudItem xs="12" sm="12" md="6">
                                <MudTextField @bind-Value="NewUser.ConfirmPassword"
                                          For="@(() => NewUser.ConfirmPassword)"
                                          Label="Confirm Password"
                                          Variant="Variant.Text"
                                          InputType="@PasswordInput"
                                          Adornment="Adornment.End"
                                          AdornmentIcon="@PasswordInputIcon"
                                          OnAdornmentClick="TogglePasswordVisibility"
                                          AdornmentAriaLabel="Show Password"
                                          Immediate="true" />
                            </MudItem>
                        </MudGrid>

                        <MudGrid>
                            <MudItem xs="12">
                                <MudList Dense="true" Class="ma-0">
                                    <MudListItem Icon="@Icons.Filled.CheckCircleOutline" IconColor="@(NewUser.PasswordInRange ? Color.Success : Color.Error)" IconSize="Size.Small" Class="py-0">
                                        Between 8 and 30 characters
                                    </MudListItem>
                                    <MudListItem Icon="@Icons.Filled.CheckCircleOutline" IconColor="@(NewUser.PasswordLowerCase ? Color.Success : Color.Error)" IconSize="Size.Small" Class="py-0">
                                        At least one lower case character
                                    </MudListItem>
                                    <MudListItem Icon="@Icons.Filled.CheckCircleOutline" IconColor="@(NewUser.PasswordUpperCase ? Color.Success : Color.Error)" IconSize="Size.Small" Class="py-0">
                                        At least one upper case character
                                    </MudListItem>
                                    <MudListItem Icon="@Icons.Filled.CheckCircleOutline" IconColor="@(NewUser.PasswordHasNumber ? Color.Success : Color.Error)" IconSize="Size.Small" Class="py-0">
                                        At least one number
                                    </MudListItem>
                                    <MudListItem Icon="@Icons.Filled.CheckCircleOutline" IconColor="@(NewUser.PasswordSpecialChar ? Color.Success : Color.Error)" IconSize="Size.Small" Class="py-0">
                                        At least one special character (@("!@#$%^&*"))
                                    </MudListItem>
                                    <MudListItem Icon="@Icons.Filled.CheckCircleOutline" IconColor="@(NewUser.PasswordsMatch ? Color.Success : Color.Error)" IconSize="Size.Small" Class="py-0">
                                        Passwords match
                                    </MudListItem>
                                </MudList>
                            </MudItem>
                        </MudGrid>

                        <MudGrid>
                            <MudItem xs="12" Class="d-flex justify-sm-end justify-center">
                                <MudButton Disabled="@BtnCreateAccount" ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="my-3 flex-md-grow-0 flex-grow-1">
                                    @if (BtnCreateAccount)
                                    {
                                        <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
                                        <MudText Class="ms-2">Processing</MudText>
                                    }
                                    else
                                    {
                                        <MudText>Create Account</MudText>
                                    }
                                </MudButton>
                            </MudItem>
                        </MudGrid>

                        @if (AccountCreated)
                        {
                            <MudDialog @bind-IsVisible="DialogVisible" Options="dialogOptions">
                                <TitleContent>
                                    <MudText Typo="Typo.h6">
                                        Success
                                    </MudText>
                                </TitleContent>
                                <DialogContent>
                                    <MudText>
                                        Account created successfully.
                                    </MudText>
                                </DialogContent>
                                <DialogActions>
                                    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Submit" Class="px-10">Close</MudButton>
                                </DialogActions>
                            </MudDialog>
                        }
                    </EditForm>
                </MudItem>
            }
        </MudGrid>
    </MudPaper>
</MudContainer>

@code {
    void Submit() => DialogVisible = false;

    private DialogOptions dialogOptions = new() { FullWidth = true };
}